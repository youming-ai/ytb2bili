(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[826],{1786:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(1847).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},5100:(e,s,t)=>{Promise.resolve().then(t.bind(t,6609))},5921:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(1847).A)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])},6609:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p});var a=t(5155),l=t(2115),i=t(8765),r=t(9559),d=t(6983),n=t(1786),c=t(5921),x=t(2529);let o=(0,t(1847).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);function h(e){let{onVideoSelect:s}=e,[t,i]=(0,l.useState)([]),[h,j]=(0,l.useState)(!0),[g,p]=(0,l.useState)(!1),[b,v]=(0,l.useState)(new Set),[u,y]=(0,l.useState)(1),[N,f]=(0,l.useState)(1);(0,l.useEffect)(()=>{w();let e=setInterval(w,3e4);return()=>clearInterval(e)},[]);let w=async()=>{try{p(!0);let e=await fetch("/api/v1/videos?page=1&limit=1000"),s=await e.json();(0===s.code||200===s.code)&&s.data&&i(s.data.videos||[])}catch(e){console.error("获取视频列表失败:",e)}finally{j(!1),p(!1)}},k=async(e,s)=>{let t="".concat(e,"-").concat(s);if(!b.has(t))try{v(e=>new Set(e).add(t));let a=await fetch("/api/v1/videos/".concat(e,"/upload/").concat(s),{method:"POST",headers:{"Content-Type":"application/json"}}),l=await a.json();if(0===l.code||200===l.code)alert("".concat("video"===s?"视频":"字幕","上传任务已成功触发！")),await w();else throw Error(l.message||"上传失败")}catch(e){console.error("手动上传失败:",e),alert("上传失败: ".concat(e instanceof Error?e.message:"未知错误"))}finally{v(e=>{let s=new Set(e);return s.delete(t),s})}},A=t.filter(e=>"200"===e.status).map(e=>({id:e.id,video:e,type:"video",status:"pending"})),S=t.filter(e=>"300"===e.status).map(e=>({id:e.id,video:e,type:"subtitle",status:"pending"})),_=A.slice((u-1)*10,10*u),C=Math.ceil(A.length/10),P=S.slice((N-1)*10,10*N),E=Math.ceil(S.length/10);return h?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"加载定时任务..."})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"定时上传管理"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"手动触发或查看自动上传任务"})]}),(0,a.jsxs)("button",{onClick:w,disabled:g,className:"flex items-center space-x-2 px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50",children:[(0,a.jsx)(r.A,{className:"w-4 h-4 ".concat(g?"animate-spin":"")}),(0,a.jsx)("span",{children:"刷新"})]})]}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(d.A,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"自动上传策略"}),(0,a.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"视频上传"}),"：每小时自动上传1个准备就绪的视频到Bilibili"]}),(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"字幕上传"}),"：视频上传完成1小时后，自动上传对应的字幕文件"]}),(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"手动触发"}),'：您可以随时点击下方的"立即上传"按钮手动触发上传任务']})]})]})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[(0,a.jsx)(n.A,{className:"w-5 h-5 text-purple-600"}),(0,a.jsx)("span",{children:"视频上传队列"}),(0,a.jsxs)("span",{className:"text-sm font-normal text-gray-500",children:["(",A.length," 个待上传)"]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200",children:0===A.length?(0,a.jsxs)("div",{className:"p-12 text-center text-gray-500",children:[(0,a.jsx)(n.A,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,a.jsx)("p",{children:"暂无待上传的视频"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"所有准备就绪的视频将显示在这里"})]}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:_.map(e=>{let s="".concat(e.id,"-video"),t=b.has(s);return(0,a.jsx)("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.video.title||e.video.video_id}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded bg-green-100 text-green-700",children:"准备就绪"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["视频ID: ",e.video.video_id]}),(0,a.jsxs)("span",{children:["准备完成: ",new Date(e.video.updated_at).toLocaleString("zh-CN")]})]})]}),(0,a.jsx)("button",{onClick:()=>k(e.id,"video"),disabled:t,className:"ml-4 flex items-center space-x-2 px-4 py-2 text-sm text-white bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.A,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"上传中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"立即上传"})]})})]})},e.id)})})}),C>1&&(0,a.jsx)(m,{currentPage:u,totalPages:C,onPageChange:y})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[(0,a.jsx)(n.A,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsx)("span",{children:"字幕上传队列"}),(0,a.jsxs)("span",{className:"text-sm font-normal text-gray-500",children:["(",S.length," 个待上传)"]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200",children:0===S.length?(0,a.jsxs)("div",{className:"p-12 text-center text-gray-500",children:[(0,a.jsx)(n.A,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,a.jsx)("p",{children:"暂无待上传的字幕"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"视频上传完成1小时后，字幕任务将显示在这里"})]}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:P.map(e=>{let s="".concat(e.id,"-subtitle"),t=b.has(s);return(0,a.jsx)("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.video.title||e.video.video_id}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded bg-cyan-100 text-cyan-700",children:"视频已上传"}),e.video.bili_bvid&&(0,a.jsx)("a",{href:"https://www.bilibili.com/video/".concat(e.video.bili_bvid),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline",children:e.video.bili_bvid})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["视频ID: ",e.video.video_id]}),(0,a.jsxs)("span",{children:["视频上传: ",new Date(e.video.updated_at).toLocaleString("zh-CN")]})]})]}),(0,a.jsx)("button",{onClick:()=>k(e.id,"subtitle"),disabled:t,className:"ml-4 flex items-center space-x-2 px-4 py-2 text-sm text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.A,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"上传中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"立即上传"})]})})]})},e.id)})})}),E>1&&(0,a.jsx)(m,{currentPage:N,totalPages:E,onPageChange:f})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,a.jsx)(x.A,{className:"w-5 h-5 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"准备就绪"}),(0,a.jsx)("div",{className:"text-xl font-bold text-gray-900",children:A.length})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-cyan-100 rounded-lg",children:(0,a.jsx)(n.A,{className:"w-5 h-5 text-cyan-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"等待上传字幕"}),(0,a.jsx)("div",{className:"text-xl font-bold text-gray-900",children:S.length})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(o,{className:"w-5 h-5 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"总待处理任务"}),(0,a.jsx)("div",{className:"text-xl font-bold text-gray-900",children:A.length+S.length})]})]})})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"使用说明"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-2",children:[(0,a.jsxs)("p",{children:["1. ",(0,a.jsx)("strong",{children:"自动上传"}),"：系统每5分钟检查一次，按照策略自动执行上传任务"]}),(0,a.jsxs)("p",{children:["2. ",(0,a.jsx)("strong",{children:"手动上传"}),'：点击"立即上传"按钮可以立即触发上传，无需等待自动调度']}),(0,a.jsxs)("p",{children:["3. ",(0,a.jsx)("strong",{children:"上传限制"}),"：为避免被限流，建议手动上传时注意频率控制"]}),(0,a.jsxs)("p",{children:["4. ",(0,a.jsx)("strong",{children:"任务状态"}),"：上传完成后，任务会自动从队列中移除"]})]})]})]})}let m=e=>{let{currentPage:s,totalPages:t,onPageChange:l}=e;return(0,a.jsxs)("div",{className:"flex justify-center items-center space-x-2 mt-4",children:[(0,a.jsx)("button",{onClick:()=>l(s-1),disabled:1===s,className:"px-3 py-1 text-sm text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"上一页"}),(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:["第 ",s," 页 / 共 ",t," 页"]}),(0,a.jsx)("button",{onClick:()=>l(s+1),disabled:s===t,className:"px-3 py-1 text-sm text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"下一页"})]})};var j=t(9910),g=t(854);function p(){let{user:e,loading:s,handleLoginSuccess:t,handleRefreshStatus:r,handleLogout:n}=(0,g.A)(),[c,x]=(0,l.useState)(null);return s?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"加载中..."})]})}):e?(0,a.jsx)(i.A,{user:e,onLogout:n,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(d.A,{className:"w-5 h-5 text-gray-600"}),(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"定时上传"})]})}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(h,{onVideoSelect:e=>{x(e)}})})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-16",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Bili-Up Web"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Bilibili 视频管理平台"})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-lg",children:(0,a.jsx)(j.A,{onLoginSuccess:t,onRefreshStatus:r})})]})})})}}},e=>{e.O(0,[937,419,441,255,358],()=>e(e.s=5100)),_N_E=e.O()}]);