(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{1786:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});let l=(0,t(1847).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},4421:(e,s,t)=>{Promise.resolve().then(t.bind(t,9931))},5921:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});let l=(0,t(1847).A)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])},6132:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});let l=(0,t(1847).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},9931:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>y});var l=t(5155),a=t(2115),r=t(8765),i=t(6983),d=t(5921),c=t(2529),n=t(1786),o=t(6132),x=t(9559);function m(e){let{onVideoSelect:s}=e,[t,r]=(0,a.useState)([]),[m,h]=(0,a.useState)(!0),[b,u]=(0,a.useState)("all"),[y,p]=(0,a.useState)(!1),[j,N]=(0,a.useState)(null),[v,f]=(0,a.useState)(null),[w,k]=(0,a.useState)(!1),[A,_]=(0,a.useState)(1);(0,a.useEffect)(()=>{S();let e=setInterval(S,3e4);return()=>clearInterval(e)},[]);let S=async()=>{try{p(!0);let e=await fetch("/api/v1/videos?page=1&limit=1000"),s=await e.json();console.log("视频数据响应:",s),(0===s.code||200===s.code)&&s.data&&(r(s.data.videos||[]),console.log("成功加载视频:",s.data.videos.length))}catch(e){console.error("获取视频列表失败:",e)}finally{h(!1),p(!1)}},C=async e=>{if(j===e)N(null),f(null);else{N(e),k(!0);try{let s=await fetch("/api/v1/videos/".concat(e)),t=await s.json();200===t.code||0===t.code?f(t.data):console.error("Failed to fetch video details:",t.message)}catch(e){console.error("Error fetching video details:",e)}finally{k(!1)}}},E=async(e,s)=>{try{let t=await fetch("/api/v1/videos/".concat(e,"/steps/").concat(s,"/retry"),{method:"POST"}),l=await t.json();200===l.code||0===l.code?C(e):console.error("Failed to retry step:",l.message)}catch(e){console.error("Error retrying step:",e)}},B={pending:t.filter(e=>"001"===e.status),preparing:t.filter(e=>"002"===e.status),ready:t.filter(e=>"200"===e.status),uploading:t.filter(e=>["201","300","301"].includes(e.status)),completed:t.filter(e=>"400"===e.status),failed:t.filter(e=>["299","399","999"].includes(e.status))},L="all"===b?t:B[b],D=Math.ceil(L.length/10),I=L.slice((A-1)*10,10*A),O=e=>{e>=1&&e<=D&&_(e)},P=[{key:"all",label:"全部",count:t.length},{key:"pending",label:"待处理",count:B.pending.length},{key:"preparing",label:"准备中",count:B.preparing.length},{key:"ready",label:"准备就绪",count:B.ready.length},{key:"uploading",label:"上传中",count:B.uploading.length},{key:"completed",label:"已完成",count:B.completed.length},{key:"failed",label:"失败",count:B.failed.length}];return m?(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"加载任务数据..."})]})}):(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"任务管理"}),(0,l.jsxs)("button",{onClick:S,disabled:y,className:"flex items-center space-x-2 px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50",children:[(0,l.jsx)(x.A,{className:"w-4 h-4 ".concat(y?"animate-spin":"")}),(0,l.jsx)("span",{children:"刷新"})]})]}),(0,l.jsx)("div",{className:"border-b border-gray-200",children:(0,l.jsx)("div",{className:"flex space-x-8",children:P.map(e=>(0,l.jsxs)("button",{onClick:()=>u(e.key),className:"pb-3 px-1 text-sm font-medium border-b-2 transition-colors ".concat(b===e.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.label,e.count>0&&(0,l.jsx)("span",{className:"ml-2 text-xs px-2 py-0.5 rounded ".concat(b===e.key?"bg-blue-100":"bg-gray-100"),children:e.count})]},e.key))})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"视频处理任务链"})}),(0,l.jsx)("div",{className:"bg-white rounded-lg border border-gray-200",children:0===I.length?(0,l.jsx)("div",{className:"p-12 text-center text-gray-500",children:"暂无任务数据"}):(0,l.jsx)("div",{className:"divide-y divide-gray-200",children:I.map(e=>{var s;let t=(s=e.status,({"001":{label:"待处理",color:"bg-gray-100 text-gray-700",icon:i.A,category:"pending"},"002":{label:"处理中",color:"bg-blue-100 text-blue-700",icon:d.A,category:"preparing"},200:{label:"准备就绪",color:"bg-green-100 text-green-700",icon:c.A,category:"ready"},201:{label:"上传视频中",color:"bg-purple-100 text-purple-700",icon:n.A,category:"uploading"},299:{label:"上传失败",color:"bg-red-100 text-red-700",icon:o.A,category:"failed"},300:{label:"视频已上传",color:"bg-cyan-100 text-cyan-700",icon:c.A,category:"uploading"},301:{label:"上传字幕中",color:"bg-indigo-100 text-indigo-700",icon:n.A,category:"uploading"},399:{label:"字幕上传失败",color:"bg-orange-100 text-orange-700",icon:o.A,category:"failed"},400:{label:"全部完成",color:"bg-emerald-100 text-emerald-700",icon:c.A,category:"completed"},999:{label:"任务失败",color:"bg-red-100 text-red-700",icon:o.A,category:"failed"}})[s]||{label:"未知",color:"bg-gray-100 text-gray-700",icon:o.A,category:"all"}),a=t.icon;return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"p-4 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>C(e.id),children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900",children:e.title||e.video_id}),(0,l.jsxs)("span",{className:"flex items-center space-x-1 text-xs px-2 py-1 rounded ".concat(t.color),children:[(0,l.jsx)(a,{className:"w-3 h-3"}),(0,l.jsx)("span",{children:t.label})]}),e.bili_bvid&&(0,l.jsx)("a",{href:"https://www.bilibili.com/video/".concat(e.bili_bvid),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline",children:e.bili_bvid})]}),(0,l.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:{"001":"等待开始处理","002":"正在执行准备任务链（下载视频→生成字幕→翻译字幕→生成元数据）",200:"准备阶段完成，等待视频上传（每小时上传1个）",201:"正在上传视频到Bilibili",299:"视频上传失败，需要重试",300:"视频已上传，等待1小时后上传字幕",301:"正在上传字幕到Bilibili",399:"字幕上传失败，需要重试",400:"所有任务已完成",999:"准备阶段失败，需要检查任务步骤"}[e.status]||"未知状态"}),(0,l.jsxs)("div",{className:"flex items-center space-x-6 text-xs text-gray-500",children:[(0,l.jsxs)("span",{children:["视频ID: ",e.video_id]}),(0,l.jsxs)("span",{children:["创建: ",new Date(e.created_at).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})]}),(0,l.jsxs)("span",{children:["更新: ",new Date(e.updated_at).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})]})]})]}),(0,l.jsx)("button",{className:"ml-4 px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded transition-colors",children:j===e.id?"收起详情":"查看详情"})]})}),j===e.id&&(0,l.jsx)("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:w?(0,l.jsx)("div",{className:"text-center text-gray-500",children:"加载任务步骤..."}):v&&v.task_steps?(0,l.jsx)(g,{steps:v.task_steps,onRetry:s=>E(e.id,s)}):(0,l.jsx)("div",{className:"text-center text-gray-500",children:"无任务步骤信息"})})]},e.id)})})})]}),D>1&&(0,l.jsxs)("div",{className:"flex justify-center items-center space-x-2 mt-6",children:[(0,l.jsx)("button",{onClick:()=>O(A-1),disabled:1===A,className:"px-3 py-1 text-sm text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"上一页"}),(0,l.jsxs)("span",{className:"text-sm text-gray-700",children:["第 ",A," 页 / 共 ",D," 页"]}),(0,l.jsx)("button",{onClick:()=>O(A+1),disabled:A===D,className:"px-3 py-1 text-sm text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"下一页"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"自动化调度策略"}),(0,l.jsx)("div",{className:"bg-white rounded-lg border border-gray-200",children:(0,l.jsxs)("div",{className:"p-6 space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,l.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,l.jsx)(d.A,{className:"w-4 h-4 text-blue-600"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900 mb-1",children:"准备阶段任务链"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"每5秒检查一次待处理任务，依次执行：下载视频 → 生成字幕 → 翻译字幕 → 生成元数据"}),(0,l.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["当前准备中: ",B.preparing.length," 个 | 待处理: ",B.pending.length," 个"]})]})]}),(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,l.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,l.jsx)(n.A,{className:"w-4 h-4 text-purple-600"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900 mb-1",children:"视频上传调度"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"每5分钟检查一次，每小时自动上传1个准备就绪的视频到Bilibili"}),(0,l.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["准备就绪: ",B.ready.length," 个 | 上传中: ",B.uploading.length," 个"]})]})]}),(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,l.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center",children:(0,l.jsx)(n.A,{className:"w-4 h-4 text-indigo-600"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900 mb-1",children:"字幕上传调度"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"视频上传完成1小时后，自动上传对应的字幕文件"}),(0,l.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["等待上传字幕: ",t.filter(e=>"300"===e.status).length," 个"]})]})]}),B.failed.length>0&&(0,l.jsxs)("div",{className:"flex items-start space-x-3 p-3 bg-red-50 rounded-lg",children:[(0,l.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center",children:(0,l.jsx)(o.A,{className:"w-4 h-4 text-red-600"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-red-900 mb-1",children:"失败任务提醒"}),(0,l.jsxs)("p",{className:"text-sm text-red-700",children:["当前有 ",B.failed.length," 个任务失败，请查看详情并手动重试"]})]})]})]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,l.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"总任务数"}),(0,l.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:t.length})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,l.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"进行中"}),(0,l.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:B.preparing.length+B.uploading.length})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,l.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"已完成"}),(0,l.jsx)("div",{className:"text-2xl font-bold text-green-600",children:B.completed.length})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,l.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"失败"}),(0,l.jsx)("div",{className:"text-2xl font-bold text-red-600",children:B.failed.length})]})]})]})}let g=e=>{let{steps:s,onRetry:t}=e;return(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)("h5",{className:"font-semibold text-gray-800",children:"任务步骤"}),(0,l.jsx)("ul",{className:"space-y-2",children:s.sort((e,s)=>e.step_order-s.step_order).map(e=>(0,l.jsx)("li",{className:"p-3 bg-white rounded-lg border border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"font-medium text-gray-700",children:e.step_name}),(0,l.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full ".concat((e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"running":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}})(e.status)),children:e.status})]}),e.error_msg&&(0,l.jsxs)("p",{className:"text-xs text-red-600 mt-1",children:["错误: ",e.error_msg]})]}),e.can_retry&&(0,l.jsx)("button",{onClick:()=>t(e.step_name),className:"px-3 py-1 text-xs text-blue-600 bg-blue-100 hover:bg-blue-200 rounded",children:"重试"})]})},e.step_name))})]})};var h=t(9910),b=t(854),u=t(534);function y(){let{user:e,loading:s,handleLoginSuccess:t,handleRefreshStatus:i,handleLogout:d}=(0,b.A)(),[c,n]=(0,a.useState)(null);return s?(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"加载中..."})]})}):e?(0,l.jsx)(r.A,{user:e,onLogout:d,children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md",children:[(0,l.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)(u.A,{className:"w-5 h-5 text-gray-600"}),(0,l.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"任务队列"})]})}),(0,l.jsx)("div",{className:"p-6",children:(0,l.jsx)(m,{onVideoSelect:e=>{n(e)}})})]})}):(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,l.jsx)("div",{className:"container mx-auto px-4 py-16",children:(0,l.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,l.jsxs)("div",{className:"text-center mb-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Bili-Up Web"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Bilibili 视频管理平台"})]}),(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-lg",children:(0,l.jsx)(h.A,{onLoginSuccess:t,onRefreshStatus:i})})]})})})}}},e=>{e.O(0,[937,419,441,255,358],()=>e(e.s=4421)),_N_E=e.O()}]);