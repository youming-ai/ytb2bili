(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3169:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>R});var a=t(5155),l=t(2115);let r=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e,s,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===s).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,l.forwardRef)((e,s)=>{let{color:t="currentColor",size:a=24,strokeWidth:n=2,absoluteStrokeWidth:c,className:d="",children:o,iconNode:x,...m}=e;return(0,l.createElement)("svg",{ref:s,...i,width:a,height:a,stroke:t,strokeWidth:c?24*Number(n)/Number(a):n,className:r("lucide",d),...m},[...x.map(e=>{let[s,t]=e;return(0,l.createElement)(s,t)}),...Array.isArray(o)?o:[o]])}),c=(e,s)=>{let t=(0,l.forwardRef)((t,a)=>{let{className:i,...c}=t;return(0,l.createElement)(n,{ref:a,iconNode:s,className:r("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),i),...c})});return t.displayName="".concat(e),t},d=c("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),o=c("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),x=c("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function m(e){let{onLoginSuccess:s,onRefreshStatus:t}=e,[r,i]=(0,l.useState)(""),[n,c]=(0,l.useState)(""),[m,h]=(0,l.useState)("idle"),[g,u]=(0,l.useState)(""),[b,p]=(0,l.useState)(!1),j=async()=>{h("loading"),u("正在生成二维码...");try{let e=await fetch("/api/v1/auth/qrcode");if(console.log("Response status:",e.status),console.log("Response headers:",e.headers),!e.ok)throw Error("HTTP error! status: ".concat(e.status));let s=await e.json();if(console.log("QR Code API Response:",s),0===s.code)console.log("Setting QR code URL:",s.qr_code_url),i(s.qr_code_url),c(s.auth_code),h("scanning"),u("请使用 Bilibili 手机客户端扫描二维码"),y(s.auth_code);else throw Error(s.message||"生成二维码失败")}catch(s){console.error("生成二维码失败:",s),h("error");let e=s instanceof Error?s.message:"未知错误";u("生成二维码失败: ".concat(e))}},y=e=>{if(b)return;p(!0);let a=setInterval(async()=>{try{let l=await fetch("/api/v1/auth/poll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_code:e})}),r=await l.json();0===r.code&&r.login_info?(h("success"),u("登录成功！正在跳转..."),p(!1),clearInterval(a),setTimeout(()=>{if(t&&t(),s){var e,a,l,i,n,c;s({id:(null==(a=r.login_info.token_info)||null==(e=a.mid)?void 0:e.toString())||"",name:(null==(l=r.login_info.token_info)?void 0:l.uname)||"Bilibili用户",mid:(null==(n=r.login_info.token_info)||null==(i=n.mid)?void 0:i.toString())||"",avatar:(null==(c=r.login_info.token_info)?void 0:c.face)||""})}},1e3)):(400===l.status||500===l.status)&&(h("error"),u("二维码已过期，请重新生成"),p(!1),clearInterval(a))}catch(e){console.error("检查登录状态失败:",e)}},2e3);setTimeout(()=>{b&&(p(!1),clearInterval(a),"scanning"===m&&(h("error"),u("二维码已过期，请重新生成")))},3e5)};(0,l.useEffect)(()=>(j(),()=>{p(!1)}),[j]);let v=()=>{p(!1),j()};return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-6 p-8",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Bilibili 扫码登录"}),(0,a.jsx)("p",{className:"text-gray-600",children:"使用 Bilibili 手机客户端扫描下方二维码完成登录"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"w-64 h-64 border-2 border-gray-200 rounded-lg flex items-center justify-center bg-white",children:["loading"===m&&(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(d,{className:"w-8 h-8 animate-spin text-blue-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"生成中..."})]}),"scanning"===m&&r&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:r,alt:"登录二维码",width:240,height:240,className:"rounded",onLoad:()=>console.log("QR code image loaded successfully"),onError:e=>{console.error("QR code image load error:",e),console.error("Failed to load QR code URL:",r),h("error"),u("二维码图片加载失败，请重试")}}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b truncate",children:r})]}),"success"===m&&(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(o,{className:"w-12 h-12 text-green-500"}),(0,a.jsx)("span",{className:"text-sm text-green-600 font-medium",children:"登录成功"})]}),"error"===m&&(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(x,{className:"w-12 h-12 text-red-500"}),(0,a.jsx)("span",{className:"text-sm text-red-600 text-center",children:g})]})]}),"scanning"===m&&(0,a.jsx)("div",{className:"absolute -top-2 -right-2",children:(0,a.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded-full animate-pulse"})})]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{className:"text-sm ".concat("success"===m?"text-green-600":"error"===m?"text-red-600":"text-gray-600"),children:g})}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[("error"===m||"idle"===m)&&(0,a.jsxs)("button",{onClick:v,className:"flex items-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[(0,a.jsx)(d,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"重新生成"})]}),"scanning"===m&&(0,a.jsxs)("button",{onClick:v,className:"flex items-center space-x-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[(0,a.jsx)(d,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"刷新二维码"})]})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center max-w-sm",children:(0,a.jsx)("p",{children:"打开 Bilibili 手机客户端，点击右上角扫一扫图标， 扫描上方二维码即可快速登录"})})]})}let h=c("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),g=c("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),u=c("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),b=c("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);function p(e){let{onSubmit:s}=e,[t,r]=(0,l.useState)({url:"",title:"",subtitles:[]}),[i,n]=(0,l.useState)(""),[c,d]=(0,l.useState)(!1),[x,m]=(0,l.useState)(null),p=async e=>{if(e.preventDefault(),!t.url||!t.title)return void alert("请填写完整信息");d(!0);try{let e=await fetch("/api/v1/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await e.json();200===a.code?(alert("视频提交成功！"),s&&s(a.data),r({url:"",title:"",subtitles:[]}),n(""),m(null)):alert("提交失败: ".concat(a.message))}catch(e){console.error("提交失败:",e),alert("提交失败，请重试")}finally{d(!1)}};return(0,a.jsxs)("div",{className:"max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:[(0,a.jsx)(h,{className:"inline-block w-6 h-6 mr-2"}),"提交新视频"]}),(0,a.jsx)("p",{className:"text-gray-600",children:"支持 YouTube 和 Bilibili 视频链接"})]}),(0,a.jsxs)("form",{onSubmit:p,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,a.jsx)(g,{className:"inline-block w-4 h-4 mr-1"}),"视频链接"]}),(0,a.jsx)("input",{type:"url",value:t.url,onChange:e=>{let s=e.target.value;r(e=>({...e,url:s})),s&&(s.includes("youtube.com")||s.includes("bilibili.com"))?m({is_valid:!0,errors:[],warnings:[]}):s?m({is_valid:!1,errors:["不支持的视频URL格式"],warnings:[]}):m(null)},placeholder:"https://www.youtube.com/watch?v=...",className:"input-field",required:!0}),x&&(0,a.jsx)("div",{className:"mt-2",children:x.is_valid?(0,a.jsxs)("div",{className:"flex items-center text-sm text-green-600",children:[(0,a.jsx)(o,{className:"w-4 h-4 mr-1"}),"URL格式正确"]}):(0,a.jsx)("div",{className:"text-sm text-red-600",children:x.errors.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(u,{className:"w-4 h-4 mr-1"}),e]},s))})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"视频标题"}),(0,a.jsx)("input",{type:"text",value:t.title,onChange:e=>r(s=>({...s,title:e.target.value})),placeholder:"输入视频标题",className:"input-field",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,a.jsx)(b,{className:"inline-block w-4 h-4 mr-1"}),"字幕内容 (可选)"]}),(0,a.jsx)("textarea",{value:i,onChange:e=>{let s=e.target.value;if(n(s),s.trim()){let e=(e=>{let s=e.split("\n").filter(e=>e.trim()),t=[],a=0;for(let e of s)e.trim()&&(t.push({text:e.trim(),duration:3,offset:a,lang:"en"}),a+=3);return t})(s);r(s=>({...s,subtitles:e}))}else r(e=>({...e,subtitles:[]}))},placeholder:"每行一句字幕，系统会自动设置时间轴",rows:8,className:"input-field resize-none"}),t.subtitles.length>0&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["已解析 ",t.subtitles.length," 条字幕"]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{r({url:"",title:"",subtitles:[]}),n(""),m(null)},className:"btn-secondary",children:"重置"}),(0,a.jsx)("button",{type:"submit",disabled:c||!(null==x?void 0:x.is_valid),className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"inline-block w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"}),"提交中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h,{className:"inline-block w-4 h-4 mr-2"}),"提交视频"]})})]})]})]})}let j=c("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),y=c("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),v={"001":{label:"待处理",className:"status-pending",icon:y,description:"视频已提交，等待处理"},"002":{label:"处理中",className:"status-processing",icon:d,description:"正在下载和处理视频"},200:{label:"准备就绪",className:"status-ready",icon:o,description:"视频准备完成，等待上传"},201:{label:"上传视频中",className:"status-uploading",icon:h,description:"正在上传视频到Bilibili"},299:{label:"上传失败",className:"status-upload-failed",icon:x,description:"视频上传失败"},300:{label:"视频已上传",className:"status-video-uploaded",icon:o,description:"视频上传成功，等待上传字幕"},301:{label:"上传字幕中",className:"status-uploading-subtitle",icon:b,description:"正在上传字幕到Bilibili"},399:{label:"字幕上传失败",className:"status-subtitle-failed",icon:x,description:"字幕上传失败"},400:{label:"全部完成",className:"status-all-completed",icon:o,description:"所有任务已完成"},999:{label:"任务失败",className:"status-failed",icon:x,description:"准备阶段失败"}};function N(e){let{status:s,showDescription:t=!1}=e,l=v[s];if(!l)return(0,a.jsxs)("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-sm flex items-center space-x-1",children:[(0,a.jsx)(u,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"未知状态"})]});let r=l.icon,i=["002","201","301"].includes(s);return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("span",{className:"".concat(l.className," flex items-center space-x-1"),children:[(0,a.jsx)(r,{className:"w-3 h-3 ".concat(i?"animate-spin":"")}),(0,a.jsx)("span",{children:l.label})]}),t&&(0,a.jsx)("span",{className:"text-xs text-gray-500 mt-1",children:l.description})]})}function f(e){let{onVideoSelect:s}=e,[t,r]=(0,l.useState)([]),[i,n]=(0,l.useState)(!0),[c,o]=(0,l.useState)(1),[x,m]=(0,l.useState)(0),h=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;n(!0);try{let s=await fetch("/api/v1/videos?page=".concat(e,"&limit=10")),t=await s.json();200===t.code?(r(t.data.videos||[]),m(t.data.total||0)):console.error("获取视频列表失败:",t.message)}catch(e){console.error("获取视频列表失败:",e)}finally{n(!1)}};return((0,l.useEffect)(()=>{h(c)},[c]),i)?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(d,{className:"w-8 h-8 animate-spin text-blue-500"}),(0,a.jsx)("span",{className:"text-gray-500",children:"加载中..."})]})}):(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"视频列表"}),(0,a.jsxs)("button",{onClick:()=>{h(c)},className:"flex items-center space-x-2 px-3 py-1 text-sm text-gray-600 hover:text-gray-900 transition-colors",children:[(0,a.jsx)(d,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"刷新"})]})]}),x>0&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["共 ",x," 个视频"]})]}),(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:0===t.length?(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)(j,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),(0,a.jsx)("p",{className:"text-gray-500",children:"暂无视频"})]}):t.map(e=>(0,a.jsxs)("div",{className:"p-6 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>null==s?void 0:s(e.video_id),children:[(0,a.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,a.jsx)("div",{className:"w-20 h-12 bg-gray-200 rounded flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(j,{className:"w-6 h-6 text-gray-400"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:e.generated_title||e.title||"未设置标题"}),e.generated_title&&e.generated_title!==e.title&&(0,a.jsxs)("p",{className:"text-xs text-gray-400 truncate",children:["原标题: ",e.title]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["ID: ",e.video_id]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.generated_tags&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.generated_tags.split(",").slice(0,3).map((e,s)=>(0,a.jsx)("span",{className:"inline-block px-1 py-0.5 text-xs bg-blue-100 text-blue-800 rounded",children:e.trim()},s))})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[(0,a.jsx)(N,{status:e.status}),e.bili_bvid&&(0,a.jsx)("a",{href:"https://www.bilibili.com/video/".concat(e.bili_bvid),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-800 underline",onClick:e=>e.stopPropagation(),children:"访问B站"})]})]}),(0,a.jsx)("div",{className:"mt-2 ml-24",children:(0,a.jsx)("p",{className:"text-xs text-gray-400 truncate",children:e.url})})]},e.id))}),x>10&&(0,a.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("button",{onClick:()=>o(c-1),disabled:1===c,className:"px-3 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"上一页"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["第 ",c," 页，共 ",Math.ceil(x/10)," 页"]}),(0,a.jsx)("button",{onClick:()=>o(c+1),disabled:c>=Math.ceil(x/10),className:"px-3 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"下一页"})]})})]})}function w(e){let{onVideoSelect:s}=e,[t,r]=(0,l.useState)([]),[i,n]=(0,l.useState)(!0),[c,x]=(0,l.useState)("all"),[m,g]=(0,l.useState)(!1),[b,p]=(0,l.useState)(null),[v,N]=(0,l.useState)(null),[f,w]=(0,l.useState)(!1),[_,S]=(0,l.useState)(1);(0,l.useEffect)(()=>{C();let e=setInterval(C,3e4);return()=>clearInterval(e)},[]);let C=async()=>{try{g(!0);let e=await fetch("/api/v1/videos?page=1&limit=1000"),s=await e.json();console.log("视频数据响应:",s),(0===s.code||200===s.code)&&s.data&&(r(s.data.videos||[]),console.log("成功加载视频:",s.data.videos.length))}catch(e){console.error("获取视频列表失败:",e)}finally{n(!1),g(!1)}},M=async e=>{if(b===e)p(null),N(null);else{p(e),w(!0);try{let s=await fetch("/api/v1/videos/".concat(e)),t=await s.json();200===t.code||0===t.code?N(t.data):console.error("Failed to fetch video details:",t.message)}catch(e){console.error("Error fetching video details:",e)}finally{w(!1)}}},E=async(e,s)=>{try{let t=await fetch("/api/v1/videos/".concat(e,"/steps/").concat(s,"/retry"),{method:"POST"}),a=await t.json();200===a.code||0===a.code?M(e):console.error("Failed to retry step:",a.message)}catch(e){console.error("Error retrying step:",e)}},L={pending:t.filter(e=>"001"===e.status),preparing:t.filter(e=>"002"===e.status),ready:t.filter(e=>"200"===e.status),uploading:t.filter(e=>["201","300","301"].includes(e.status)),completed:t.filter(e=>"400"===e.status),failed:t.filter(e=>["299","399","999"].includes(e.status))},B="all"===c?t:L[c],R=Math.ceil(B.length/10),z=B.slice((_-1)*10,10*_),P=e=>{e>=1&&e<=R&&S(e)},T=[{key:"all",label:"全部",count:t.length},{key:"pending",label:"待处理",count:L.pending.length},{key:"preparing",label:"准备中",count:L.preparing.length},{key:"ready",label:"准备就绪",count:L.ready.length},{key:"uploading",label:"上传中",count:L.uploading.length},{key:"completed",label:"已完成",count:L.completed.length},{key:"failed",label:"失败",count:L.failed.length}];return i?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"加载任务数据..."})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"任务管理"}),(0,a.jsxs)("button",{onClick:C,disabled:m,className:"flex items-center space-x-2 px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50",children:[(0,a.jsx)(d,{className:"w-4 h-4 ".concat(m?"animate-spin":"")}),(0,a.jsx)("span",{children:"刷新"})]})]}),(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsx)("div",{className:"flex space-x-8",children:T.map(e=>(0,a.jsxs)("button",{onClick:()=>x(e.key),className:"pb-3 px-1 text-sm font-medium border-b-2 transition-colors ".concat(c===e.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.label,e.count>0&&(0,a.jsx)("span",{className:"ml-2 text-xs px-2 py-0.5 rounded ".concat(c===e.key?"bg-blue-100":"bg-gray-100"),children:e.count})]},e.key))})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"视频处理任务链"})}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200",children:0===z.length?(0,a.jsx)("div",{className:"p-12 text-center text-gray-500",children:"暂无任务数据"}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:z.map(e=>{let s={"001":{label:"待处理",color:"bg-gray-100 text-gray-700",icon:y,category:"pending"},"002":{label:"处理中",color:"bg-blue-100 text-blue-700",icon:j,category:"preparing"},200:{label:"准备就绪",color:"bg-green-100 text-green-700",icon:o,category:"ready"},201:{label:"上传视频中",color:"bg-purple-100 text-purple-700",icon:h,category:"uploading"},299:{label:"上传失败",color:"bg-red-100 text-red-700",icon:u,category:"failed"},300:{label:"视频已上传",color:"bg-cyan-100 text-cyan-700",icon:o,category:"uploading"},301:{label:"上传字幕中",color:"bg-indigo-100 text-indigo-700",icon:h,category:"uploading"},399:{label:"字幕上传失败",color:"bg-orange-100 text-orange-700",icon:u,category:"failed"},400:{label:"全部完成",color:"bg-emerald-100 text-emerald-700",icon:o,category:"completed"},999:{label:"任务失败",color:"bg-red-100 text-red-700",icon:u,category:"failed"}}[e.status]||{label:"未知",color:"bg-gray-100 text-gray-700",icon:u,category:"all"},t=s.icon;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"p-4 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>M(e.id),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.title||e.video_id}),(0,a.jsxs)("span",{className:"flex items-center space-x-1 text-xs px-2 py-1 rounded ".concat(s.color),children:[(0,a.jsx)(t,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:s.label})]}),e.bili_bvid&&(0,a.jsx)("a",{href:"https://www.bilibili.com/video/".concat(e.bili_bvid),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline",children:e.bili_bvid})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:{"001":"等待开始处理","002":"正在执行准备任务链（下载视频→生成字幕→翻译字幕→生成元数据）",200:"准备阶段完成，等待视频上传（每小时上传1个）",201:"正在上传视频到Bilibili",299:"视频上传失败，需要重试",300:"视频已上传，等待1小时后上传字幕",301:"正在上传字幕到Bilibili",399:"字幕上传失败，需要重试",400:"所有任务已完成",999:"准备阶段失败，需要检查任务步骤"}[e.status]||"未知状态"}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["视频ID: ",e.video_id]}),(0,a.jsxs)("span",{children:["创建: ",new Date(e.created_at).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})]}),(0,a.jsxs)("span",{children:["更新: ",new Date(e.updated_at).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})]})]})]}),(0,a.jsx)("button",{className:"ml-4 px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded transition-colors",children:b===e.id?"收起详情":"查看详情"})]})}),b===e.id&&(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:f?(0,a.jsx)("div",{className:"text-center text-gray-500",children:"加载任务步骤..."}):v&&v.task_steps?(0,a.jsx)(k,{steps:v.task_steps,onRetry:s=>E(e.id,s)}):(0,a.jsx)("div",{className:"text-center text-gray-500",children:"无任务步骤信息"})})]},e.id)})})})]}),R>1&&(0,a.jsxs)("div",{className:"flex justify-center items-center space-x-2 mt-6",children:[(0,a.jsx)("button",{onClick:()=>P(_-1),disabled:1===_,className:"px-3 py-1 text-sm text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"上一页"}),(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:["第 ",_," 页 / 共 ",R," 页"]}),(0,a.jsx)("button",{onClick:()=>P(_+1),disabled:_===R,className:"px-3 py-1 text-sm text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"下一页"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"自动化调度策略"}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200",children:(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(j,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-1",children:"准备阶段任务链"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"每5秒检查一次待处理任务，依次执行：下载视频 → 生成字幕 → 翻译字幕 → 生成元数据"}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["当前准备中: ",L.preparing.length," 个 | 待处理: ",L.pending.length," 个"]})]})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(h,{className:"w-4 h-4 text-purple-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-1",children:"视频上传调度"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"每5分钟检查一次，每小时自动上传1个准备就绪的视频到Bilibili"}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["准备就绪: ",L.ready.length," 个 | 上传中: ",L.uploading.length," 个"]})]})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(h,{className:"w-4 h-4 text-indigo-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-1",children:"字幕上传调度"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"视频上传完成1小时后，自动上传对应的字幕文件"}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["等待上传字幕: ",t.filter(e=>"300"===e.status).length," 个"]})]})]}),L.failed.length>0&&(0,a.jsxs)("div",{className:"flex items-start space-x-3 p-3 bg-red-50 rounded-lg",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(u,{className:"w-4 h-4 text-red-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-medium text-red-900 mb-1",children:"失败任务提醒"}),(0,a.jsxs)("p",{className:"text-sm text-red-700",children:["当前有 ",L.failed.length," 个任务失败，请查看详情并手动重试"]})]})]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"总任务数"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:t.length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"进行中"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:L.preparing.length+L.uploading.length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"已完成"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:L.completed.length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-1",children:"失败"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:L.failed.length})]})]})]})}let k=e=>{let{steps:s,onRetry:t}=e;return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("h5",{className:"font-semibold text-gray-800",children:"任务步骤"}),(0,a.jsx)("ul",{className:"space-y-2",children:s.sort((e,s)=>e.step_order-s.step_order).map(e=>(0,a.jsx)("li",{className:"p-3 bg-white rounded-lg border border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:e.step_name}),(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full ".concat((e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"running":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}})(e.status)),children:e.status})]}),e.error_msg&&(0,a.jsxs)("p",{className:"text-xs text-red-600 mt-1",children:["错误: ",e.error_msg]})]}),e.can_retry&&(0,a.jsx)("button",{onClick:()=>t(e.step_name),className:"px-3 py-1 text-xs text-blue-600 bg-blue-100 hover:bg-blue-200 rounded",children:"重试"})]})},e.step_name))})]})},_=c("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);function S(e){let{onVideoSelect:s}=e,[t,r]=(0,l.useState)([]),[i,n]=(0,l.useState)(!0),[c,x]=(0,l.useState)(!1),[m,g]=(0,l.useState)(new Set),[u,b]=(0,l.useState)(1),[p,v]=(0,l.useState)(1);(0,l.useEffect)(()=>{N();let e=setInterval(N,3e4);return()=>clearInterval(e)},[]);let N=async()=>{try{x(!0);let e=await fetch("/api/v1/videos?page=1&limit=1000"),s=await e.json();(0===s.code||200===s.code)&&s.data&&r(s.data.videos||[])}catch(e){console.error("获取视频列表失败:",e)}finally{n(!1),x(!1)}},f=async(e,s)=>{let t="".concat(e,"-").concat(s);if(!m.has(t))try{g(e=>new Set(e).add(t));let a=await fetch("/api/v1/videos/".concat(e,"/upload/").concat(s),{method:"POST",headers:{"Content-Type":"application/json"}}),l=await a.json();if(0===l.code||200===l.code)alert("".concat("video"===s?"视频":"字幕","上传任务已成功触发！")),await N();else throw Error(l.message||"上传失败")}catch(e){console.error("手动上传失败:",e),alert("上传失败: ".concat(e instanceof Error?e.message:"未知错误"))}finally{g(e=>{let s=new Set(e);return s.delete(t),s})}},w=t.filter(e=>"200"===e.status).map(e=>({id:e.id,video:e,type:"video",status:"pending"})),k=t.filter(e=>"300"===e.status).map(e=>({id:e.id,video:e,type:"subtitle",status:"pending"})),S=w.slice((u-1)*10,10*u),M=Math.ceil(w.length/10),E=k.slice((p-1)*10,10*p),L=Math.ceil(k.length/10);return i?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"加载定时任务..."})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"定时上传管理"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"手动触发或查看自动上传任务"})]}),(0,a.jsxs)("button",{onClick:N,disabled:c,className:"flex items-center space-x-2 px-4 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50",children:[(0,a.jsx)(d,{className:"w-4 h-4 ".concat(c?"animate-spin":"")}),(0,a.jsx)("span",{children:"刷新"})]})]}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(y,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"自动上传策略"}),(0,a.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"视频上传"}),"：每小时自动上传1个准备就绪的视频到Bilibili"]}),(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"字幕上传"}),"：视频上传完成1小时后，自动上传对应的字幕文件"]}),(0,a.jsxs)("p",{children:["• ",(0,a.jsx)("strong",{children:"手动触发"}),'：您可以随时点击下方的"立即上传"按钮手动触发上传任务']})]})]})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[(0,a.jsx)(h,{className:"w-5 h-5 text-purple-600"}),(0,a.jsx)("span",{children:"视频上传队列"}),(0,a.jsxs)("span",{className:"text-sm font-normal text-gray-500",children:["(",w.length," 个待上传)"]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200",children:0===w.length?(0,a.jsxs)("div",{className:"p-12 text-center text-gray-500",children:[(0,a.jsx)(h,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,a.jsx)("p",{children:"暂无待上传的视频"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"所有准备就绪的视频将显示在这里"})]}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:S.map(e=>{let s="".concat(e.id,"-video"),t=m.has(s);return(0,a.jsx)("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.video.title||e.video.video_id}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded bg-green-100 text-green-700",children:"准备就绪"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["视频ID: ",e.video.video_id]}),(0,a.jsxs)("span",{children:["准备完成: ",new Date(e.video.updated_at).toLocaleString("zh-CN")]})]})]}),(0,a.jsx)("button",{onClick:()=>f(e.id,"video"),disabled:t,className:"ml-4 flex items-center space-x-2 px-4 py-2 text-sm text-white bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"上传中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"立即上传"})]})})]})},e.id)})})}),M>1&&(0,a.jsx)(C,{currentPage:u,totalPages:M,onPageChange:b})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center space-x-2",children:[(0,a.jsx)(h,{className:"w-5 h-5 text-indigo-600"}),(0,a.jsx)("span",{children:"字幕上传队列"}),(0,a.jsxs)("span",{className:"text-sm font-normal text-gray-500",children:["(",k.length," 个待上传)"]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200",children:0===k.length?(0,a.jsxs)("div",{className:"p-12 text-center text-gray-500",children:[(0,a.jsx)(h,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,a.jsx)("p",{children:"暂无待上传的字幕"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"视频上传完成1小时后，字幕任务将显示在这里"})]}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:E.map(e=>{let s="".concat(e.id,"-subtitle"),t=m.has(s);return(0,a.jsx)("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.video.title||e.video.video_id}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded bg-cyan-100 text-cyan-700",children:"视频已上传"}),e.video.bili_bvid&&(0,a.jsx)("a",{href:"https://www.bilibili.com/video/".concat(e.video.bili_bvid),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline",children:e.video.bili_bvid})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["视频ID: ",e.video.video_id]}),(0,a.jsxs)("span",{children:["视频上传: ",new Date(e.video.updated_at).toLocaleString("zh-CN")]})]})]}),(0,a.jsx)("button",{onClick:()=>f(e.id,"subtitle"),disabled:t,className:"ml-4 flex items-center space-x-2 px-4 py-2 text-sm text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"上传中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"立即上传"})]})})]})},e.id)})})}),L>1&&(0,a.jsx)(C,{currentPage:p,totalPages:L,onPageChange:v})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,a.jsx)(o,{className:"w-5 h-5 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"准备就绪"}),(0,a.jsx)("div",{className:"text-xl font-bold text-gray-900",children:w.length})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-cyan-100 rounded-lg",children:(0,a.jsx)(h,{className:"w-5 h-5 text-cyan-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"等待上传字幕"}),(0,a.jsx)("div",{className:"text-xl font-bold text-gray-900",children:k.length})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(_,{className:"w-5 h-5 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"总待处理任务"}),(0,a.jsx)("div",{className:"text-xl font-bold text-gray-900",children:w.length+k.length})]})]})})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"使用说明"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 space-y-2",children:[(0,a.jsxs)("p",{children:["1. ",(0,a.jsx)("strong",{children:"自动上传"}),"：系统每5分钟检查一次，按照策略自动执行上传任务"]}),(0,a.jsxs)("p",{children:["2. ",(0,a.jsx)("strong",{children:"手动上传"}),'：点击"立即上传"按钮可以立即触发上传，无需等待自动调度']}),(0,a.jsxs)("p",{children:["3. ",(0,a.jsx)("strong",{children:"上传限制"}),"：为避免被限流，建议手动上传时注意频率控制"]}),(0,a.jsxs)("p",{children:["4. ",(0,a.jsx)("strong",{children:"任务状态"}),"：上传完成后，任务会自动从队列中移除"]})]})]})]})}let C=e=>{let{currentPage:s,totalPages:t,onPageChange:l}=e;return(0,a.jsxs)("div",{className:"flex justify-center items-center space-x-2 mt-4",children:[(0,a.jsx)("button",{onClick:()=>l(s-1),disabled:1===s,className:"px-3 py-1 text-sm text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"上一页"}),(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:["第 ",s," 页 / 共 ",t," 页"]}),(0,a.jsx)("button",{onClick:()=>l(s+1),disabled:s===t,className:"px-3 py-1 text-sm text-gray-600 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"下一页"})]})},M=c("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),E=c("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),L=c("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),B=c("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function R(){let[e,s]=(0,l.useState)(null),[t,r]=(0,l.useState)("dashboard"),[i,n]=(0,l.useState)(null),[c,d]=(0,l.useState)(!0);(0,l.useEffect)(()=>{o()},[]);let o=async()=>{try{let e=await fetch("/api/v1/auth/status"),t=await e.json();console.log("Auth status response:",t),0===t.code&&t.is_logged_in&&t.user?(console.log("User is logged in:",t.user),s(t.user)):console.log("User is not logged in")}catch(e){console.error("检查登录状态失败:",e)}finally{d(!1)}},x=async()=>{await o()},h=async()=>{try{await fetch("/api/v1/auth/logout",{method:"POST"}),s(null)}catch(e){console.error("登出失败:",e)}},g=e=>{n(e)};return c?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"加载中..."})]})}):e?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,a.jsx)("div",{className:"container mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Bili-Up Web"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,a.jsx)(M,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:e.name})]}),(0,a.jsxs)("button",{onClick:h,className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-red-600 transition-colors",children:[(0,a.jsx)(E,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"退出登录"})]})]})]})})}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"flex gap-8",children:[(0,a.jsx)("div",{className:"w-64 flex-shrink-0",children:(0,a.jsx)("nav",{className:"bg-white rounded-lg shadow-sm p-4",children:(0,a.jsxs)("ul",{className:"space-y-2",children:[(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>{r("dashboard"),n(null)},className:"w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ".concat("dashboard"!==t||i?"text-gray-700 hover:bg-gray-50":"bg-blue-50 text-blue-700"),children:[(0,a.jsx)(L,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"任务队列"})]})}),(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>{r("schedule"),n(null)},className:"w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ".concat("schedule"===t?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"),children:[(0,a.jsx)(y,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"定时上传"})]})}),(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>{r("settings"),n(null)},className:"w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ".concat("settings"===t?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"),children:[(0,a.jsx)(B,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"设置"})]})})]})})}),(0,a.jsxs)("div",{className:"flex-1",children:["dashboard"===t&&(0,a.jsx)(w,{onVideoSelect:g}),"videos"===t&&(0,a.jsx)(f,{onVideoSelect:g}),"schedule"===t&&(0,a.jsx)(S,{onVideoSelect:g}),"upload"===t&&(0,a.jsx)(p,{onSubmit:e=>{r("videos"),n(null)}}),"settings"===t&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"设置"}),(0,a.jsx)("p",{className:"text-gray-600",children:"设置页面正在开发中..."})]})]})]})})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-16",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Bili-Up Web"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Bilibili 视频管理平台"})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-lg",children:(0,a.jsx)(m,{onLoginSuccess:e=>{s(e)},onRefreshStatus:x})})]})})})}},9827:(e,s,t)=>{Promise.resolve().then(t.bind(t,3169))}},e=>{e.O(0,[441,255,358],()=>e(e.s=9827)),_N_E=e.O()}]);