"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[419],{854:(e,s,t)=>{t.d(s,{A:()=>l});var a=t(2115);function l(){let[e,s]=(0,a.useState)(null),[t,l]=(0,a.useState)(!0),r=()=>{{let{protocol:e,hostname:s,port:t}=window.location;return"".concat(e,"//").concat(s).concat(t?":"+t:"")}},c=(0,a.useCallback)(async()=>{try{let e=r(),t=await fetch("".concat(e,"/api/v1/auth/status")),a=await t.json();console.log("Auth status response:",a),0===a.code&&a.is_logged_in&&a.user?(console.log("User is logged in:",a.user),s(a.user)):console.log("User is not logged in")}catch(e){console.error("检查登录状态失败:",e)}finally{l(!1)}},[]);return(0,a.useEffect)(()=>{c()},[c]),{user:e,loading:t,handleLoginSuccess:e=>{s(e)},handleRefreshStatus:async()=>{await c()},handleLogout:async()=>{try{let e=r();await fetch("".concat(e,"/api/v1/auth/logout"),{method:"POST"}),s(null)}catch(e){console.error("登出失败:",e)}}}}},8765:(e,s,t)=>{t.d(s,{A:()=>u});var a=t(5155),l=t(2619),r=t.n(l),c=t(63),n=t(508),i=t(4926),o=t(534),d=t(6983),x=t(8599),h=t(5870);function u(e){let{children:s,user:t,onLogout:l}=e,u=(0,c.usePathname)();return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,a.jsx)("div",{className:"container mx-auto px-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)(r(),{href:"/",className:"text-xl font-semibold text-gray-900",children:"Bili-Up Web"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[(0,a.jsx)(n.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:t.name})]}),(0,a.jsxs)("button",{onClick:l,className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-red-600 transition-colors",children:[(0,a.jsx)(i.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"退出登录"})]})]})]})})}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"flex gap-8",children:[(0,a.jsx)("div",{className:"w-64 flex-shrink-0",children:(0,a.jsx)("nav",{className:"bg-white rounded-lg shadow-sm p-4",children:(0,a.jsxs)("ul",{className:"space-y-2",children:[(0,a.jsx)("li",{children:(0,a.jsxs)(r(),{href:"/",className:"w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ".concat("/"===u?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"),children:[(0,a.jsx)(n.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"主页"})]})}),(0,a.jsx)("li",{children:(0,a.jsxs)(r(),{href:"/dashboard",className:"w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ".concat("/dashboard"===u?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"),children:[(0,a.jsx)(o.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"任务队列"})]})}),(0,a.jsx)("li",{children:(0,a.jsxs)(r(),{href:"/schedule",className:"w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ".concat("/schedule"===u?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"),children:[(0,a.jsx)(d.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"定时上传"})]})}),(0,a.jsx)("li",{children:(0,a.jsxs)(r(),{href:"/extension",className:"w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ".concat("/extension"===u?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"),children:[(0,a.jsx)(x.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"浏览器插件"})]})}),(0,a.jsx)("li",{children:(0,a.jsxs)(r(),{href:"/settings",className:"w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ".concat("/settings"===u?"bg-blue-50 text-blue-700":"text-gray-700 hover:bg-gray-50"),children:[(0,a.jsx)(h.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"设置"})]})})]})})}),(0,a.jsx)("div",{className:"flex-1",children:s})]})})]})}},9910:(e,s,t)=>{t.d(s,{A:()=>i});var a=t(5155),l=t(2115),r=t(9559),c=t(2529),n=t(8874);function i(e){let{onLoginSuccess:s,onRefreshStatus:t}=e,[i,o]=(0,l.useState)(""),[d,x]=(0,l.useState)(""),[h,u]=(0,l.useState)("idle"),[m,g]=(0,l.useState)(""),[f,j]=(0,l.useState)(!1),p=()=>{{let{protocol:e,hostname:s,port:t}=window.location;return"".concat(e,"//").concat(s).concat(t?":"+t:"")}},b=(0,l.useCallback)(async()=>{u("loading"),g("正在生成二维码...");try{let e=p(),s=await fetch("".concat(e,"/api/v1/auth/qrcode"));if(console.log("API Base URL:",e),console.log("Response status:",s.status),console.log("Response headers:",s.headers),!s.ok)throw Error("HTTP error! status: ".concat(s.status));let t=await s.json();if(console.log("QR Code API Response:",t),0===t.code)console.log("QR code URL from backend:",t.qr_code_url),o(t.qr_code_url),x(t.auth_code),u("scanning"),g("请使用 Bilibili 手机客户端扫描二维码"),N(t.auth_code);else throw Error(t.message||"生成二维码失败")}catch(s){console.error("生成二维码失败:",s),u("error");let e=s instanceof Error?s.message:"未知错误";g("生成二维码失败: ".concat(e))}},[]),N=e=>{if(f)return;j(!0);let a=setInterval(async()=>{try{let l=p(),r=await fetch("".concat(l,"/api/v1/auth/poll"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_code:e})}),c=await r.json();0===c.code&&c.login_info?(u("success"),g("登录成功！正在跳转..."),j(!1),clearInterval(a),setTimeout(()=>{if(t&&t(),s){var e,a,l,r,n,i;s({id:(null==(a=c.login_info.token_info)||null==(e=a.mid)?void 0:e.toString())||"",name:(null==(l=c.login_info.token_info)?void 0:l.uname)||"Bilibili用户",mid:(null==(n=c.login_info.token_info)||null==(r=n.mid)?void 0:r.toString())||"",avatar:(null==(i=c.login_info.token_info)?void 0:i.face)||""})}},1e3)):(400===r.status||500===r.status)&&(u("error"),g("二维码已过期，请重新生成"),j(!1),clearInterval(a))}catch(e){console.error("检查登录状态失败:",e)}},3e3);setTimeout(()=>{f&&(j(!1),clearInterval(a),"scanning"===h&&(u("error"),g("二维码已过期，请重新生成")))},3e5)};(0,l.useEffect)(()=>(b(),()=>{j(!1)}),[]);let y=()=>{j(!1),b()};return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-6 p-8",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Bilibili 扫码登录"}),(0,a.jsx)("p",{className:"text-gray-600",children:"使用 Bilibili 手机客户端扫描下方二维码完成登录"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"w-64 h-64 border-2 border-gray-200 rounded-lg flex items-center justify-center bg-white",children:["loading"===h&&(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(r.A,{className:"w-8 h-8 animate-spin text-blue-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"生成中..."})]}),"scanning"===h&&i&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:i,alt:"登录二维码",width:240,height:240,className:"rounded",onLoad:()=>console.log("QR code image loaded successfully"),onError:e=>{console.error("QR code image load error:",e),console.error("Failed to load QR code URL:",i),u("error"),g("二维码图片加载失败，请重试")}}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-b truncate",children:i})]}),"success"===h&&(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(c.A,{className:"w-12 h-12 text-green-500"}),(0,a.jsx)("span",{className:"text-sm text-green-600 font-medium",children:"登录成功"})]}),"error"===h&&(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(n.A,{className:"w-12 h-12 text-red-500"}),(0,a.jsx)("span",{className:"text-sm text-red-600 text-center",children:m})]})]}),"scanning"===h&&(0,a.jsx)("div",{className:"absolute -top-2 -right-2",children:(0,a.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded-full animate-pulse"})})]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{className:"text-sm ".concat("success"===h?"text-green-600":"error"===h?"text-red-600":"text-gray-600"),children:m})}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[("error"===h||"idle"===h)&&(0,a.jsxs)("button",{onClick:y,className:"flex items-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[(0,a.jsx)(r.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"重新生成"})]}),"scanning"===h&&(0,a.jsxs)("button",{onClick:y,className:"flex items-center space-x-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[(0,a.jsx)(r.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"刷新二维码"})]})]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center max-w-sm",children:(0,a.jsx)("p",{children:"打开 Bilibili 手机客户端，点击右上角扫一扫图标， 扫描上方二维码即可快速登录"})})]})}}}]);